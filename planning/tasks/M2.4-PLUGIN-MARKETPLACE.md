# M2.4 - Plugin Registry & Marketplace

**Status**: ğŸŸ¡ In Progress  
**Owner**: Full Stack Team  
**Duration**: 3 weeks (120 hours estimated)  
**Priority**: â­ High  
**Start Date**: January 27, 2026  
**Target Completion**: February 17, 2026

---

## ğŸ“‹ Objective

Build a comprehensive plugin marketplace with publishing workflow, versioning, ratings, and installation wizard to enable easy plugin discovery and deployment.

---

## ğŸ¯ Success Criteria

### Functionality

- âœ… Plugin versioning with semver support
- âœ… Plugin publishing workflow (draft â†’ review â†’ published)
- âœ… Search with full-text and advanced filtering
- âœ… Rating and review system
- âœ… Installation wizard for tenants
- âœ… Plugin update notifications
- âœ… Enhanced CLI publish command

### Performance

- Registry search < 200ms p95
- Plugin installation < 60s
- Marketplace page load < 2s
- Real-time search results < 100ms

### Quality

- Test coverage > 80%
- Comprehensive API documentation
- User-friendly UI/UX
- Mobile-responsive design

---

## ğŸ—ï¸ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Plugin Marketplace Flow                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  Developer                Super-Admin       Tenant   â”‚
â”‚      â”‚                         â”‚              â”‚      â”‚
â”‚      â”œâ”€ plexica publish â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚      â”‚
â”‚      â”‚                         â”‚              â”‚      â”‚
â”‚      â”‚                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”         â”‚      â”‚
â”‚      â”‚                    â”‚ Review  â”‚         â”‚      â”‚
â”‚      â”‚                    â”‚ Approve â”‚         â”‚      â”‚
â”‚      â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â”‚      â”‚
â”‚      â”‚                         â”‚              â”‚      â”‚
â”‚      â”‚                    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚      â”‚
â”‚      â”‚                    â”‚ Marketplace â”‚â—„â”€â”€â”€â”€â”¤      â”‚
â”‚      â”‚                    â”‚  (Browse)   â”‚     â”‚      â”‚
â”‚      â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚      â”‚
â”‚      â”‚                         â”‚              â”‚      â”‚
â”‚      â”‚                         â”‚         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚
â”‚      â”‚                         â”‚         â”‚Install  â”‚ â”‚
â”‚      â”‚                         â”‚         â”‚Wizard   â”‚ â”‚
â”‚      â”‚                         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Database Schema Updates

### New Tables

```prisma
// Plugin Versions
model PluginVersion {
  id             String   @id @default(uuid())
  pluginId       String
  version        String   // semver (e.g., 1.2.3)
  changelog      String   // Release notes
  manifest       Json     // Full manifest JSON
  publishedAt    DateTime @default(now())
  downloadCount  Int      @default(0)

  plugin         Plugin   @relation(fields: [pluginId], references: [id], onDelete: Cascade)

  @@unique([pluginId, version])
  @@index([pluginId])
  @@map("plugin_versions")
  @@schema("core")
}

// Plugin Ratings
model PluginRating {
  id          String   @id @default(uuid())
  pluginId    String
  tenantId    String
  userId      String
  rating      Int      // 1-5 stars
  review      String?  // Optional review text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  plugin      Plugin   @relation(fields: [pluginId], references: [id], onDelete: Cascade)
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([pluginId, tenantId, userId])
  @@index([pluginId])
  @@index([tenantId])
  @@map("plugin_ratings")
  @@schema("core")
}

// Plugin Downloads/Installs Tracking
model PluginInstallation {
  id           String   @id @default(uuid())
  pluginId     String
  version      String
  tenantId     String
  installedAt  DateTime @default(now())
  installedBy  String   // User ID

  plugin       Plugin   @relation(fields: [pluginId], references: [id], onDelete: Cascade)
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([pluginId])
  @@index([tenantId])
  @@map("plugin_installations")
  @@schema("core")
}
```

### Updated Plugin Model

```prisma
model Plugin {
  // ... existing fields

  // NEW: Marketplace fields
  status          PluginStatus  @default(DRAFT)
  publishedAt     DateTime?
  averageRating   Float         @default(0)
  ratingCount     Int           @default(0)
  downloadCount   Int           @default(0)
  installCount    Int           @default(0)
  screenshots     Json?         // Array of screenshot URLs
  demoUrl         String?       // Demo/video URL

  // Relations
  versions        PluginVersion[]
  ratings         PluginRating[]
  installations   PluginInstallation[]
}

enum PluginStatus {
  DRAFT
  PENDING_REVIEW
  PUBLISHED
  DEPRECATED
  REJECTED
}
```

---

## ğŸ”§ Backend Tasks (Week 1-2: 80 hours)

### Task 1: Database Migration (8h)

**Deliverables**:

- âœ… Migration: Add PluginVersion table
- âœ… Migration: Add PluginRating table
- âœ… Migration: Add PluginInstallation table
- âœ… Migration: Update Plugin model with marketplace fields
- âœ… Seed data: Sample plugins with versions and ratings

**Files**:

```
packages/database/prisma/migrations/XXXXXX_add_marketplace_tables/
â””â”€â”€ migration.sql

packages/database/scripts/
â””â”€â”€ seed-marketplace.ts
```

### Task 2: Plugin Versioning Service (16h)

**Deliverables**:

```typescript
// apps/core-api/src/services/plugin-version.service.ts

class PluginVersionService {
  // Create new version
  async createVersion(pluginId: string, data: CreateVersionDto): Promise<PluginVersion>;

  // Get all versions for plugin
  async getVersions(pluginId: string): Promise<PluginVersion[]>;

  // Get specific version
  async getVersion(pluginId: string, version: string): Promise<PluginVersion | null>;

  // Get latest version
  async getLatestVersion(pluginId: string): Promise<PluginVersion | null>;

  // Delete version
  async deleteVersion(pluginId: string, version: string): Promise<void>;

  // Increment download count
  async incrementDownloadCount(pluginId: string, version: string): Promise<void>;

  // Validate semver
  private validateSemver(version: string): boolean;
}
```

**Files**:

```
apps/core-api/src/services/plugin-version.service.ts (~400 lines)
apps/core-api/src/types/plugin-version.types.ts (~100 lines)
apps/core-api/src/__tests__/services/plugin-version.test.ts (~300 lines)
```

### Task 3: Plugin Rating Service (12h)

**Deliverables**:

```typescript
// apps/core-api/src/services/plugin-rating.service.ts

class PluginRatingService {
  // Create or update rating
  async ratePlugin(data: CreateRatingDto): Promise<PluginRating>;

  // Get ratings for plugin
  async getRatings(
    pluginId: string,
    options?: PaginationOptions
  ): Promise<{
    ratings: PluginRating[];
    total: number;
    averageRating: number;
  }>;

  // Get user's rating for plugin
  async getUserRating(
    pluginId: string,
    tenantId: string,
    userId: string
  ): Promise<PluginRating | null>;

  // Delete rating
  async deleteRating(ratingId: string): Promise<void>;

  // Update plugin average rating (called after new rating)
  private async updatePluginRating(pluginId: string): Promise<void>;
}
```

**Files**:

```
apps/core-api/src/services/plugin-rating.service.ts (~300 lines)
apps/core-api/src/types/plugin-rating.types.ts (~80 lines)
apps/core-api/src/__tests__/services/plugin-rating.test.ts (~250 lines)
```

### Task 4: Plugin Publishing Workflow (16h)

**Deliverables**:

```typescript
// apps/core-api/src/services/plugin-publishing.service.ts

class PluginPublishingService {
  // Submit plugin for review
  async submitForReview(pluginId: string): Promise<Plugin>;

  // Approve plugin (super-admin only)
  async approvePlugin(pluginId: string): Promise<Plugin>;

  // Reject plugin (super-admin only)
  async rejectPlugin(pluginId: string, reason: string): Promise<Plugin>;

  // Publish plugin version
  async publishVersion(pluginId: string, version: string): Promise<PluginVersion>;

  // Deprecate plugin
  async deprecatePlugin(pluginId: string, reason: string): Promise<Plugin>;

  // Validate plugin manifest before publishing
  private async validateManifest(manifest: PluginManifest): Promise<void>;
}
```

**Files**:

```
apps/core-api/src/services/plugin-publishing.service.ts (~400 lines)
apps/core-api/src/__tests__/services/plugin-publishing.test.ts (~300 lines)
```

### Task 5: Enhanced Search Service (12h)

**Deliverables**:

```typescript
// apps/core-api/src/services/plugin-search.service.ts

class PluginSearchService {
  // Full-text search with filtering
  async searchPlugins(query: PluginSearchQuery): Promise<{
    plugins: Plugin[];
    total: number;
    facets: SearchFacets;
  }>

  // Search filters
  interface PluginSearchQuery {
    q?: string;                    // Search text
    category?: string[];           // Filter by categories
    status?: PluginStatus[];       // Filter by status
    minRating?: number;            // Minimum rating (1-5)
    priceType?: 'free' | 'paid';   // Price filter
    sortBy?: 'relevance' | 'rating' | 'downloads' | 'newest';
    skip?: number;
    take?: number;
  }

  // Get popular plugins
  async getPopularPlugins(limit: number): Promise<Plugin[]>

  // Get trending plugins (based on recent installs)
  async getTrendingPlugins(limit: number): Promise<Plugin[]>

  // Get recommended plugins for tenant
  async getRecommendedPlugins(tenantId: string, limit: number): Promise<Plugin[]>
}
```

**Files**:

```
apps/core-api/src/services/plugin-search.service.ts (~350 lines)
apps/core-api/src/__tests__/services/plugin-search.test.ts (~250 lines)
```

### Task 6: REST API Endpoints (16h)

**New Endpoints**:

```typescript
// Plugin Versions
POST   /api/plugins/:pluginId/versions          // Create version
GET    /api/plugins/:pluginId/versions          // List versions
GET    /api/plugins/:pluginId/versions/:version // Get specific version
DELETE /api/plugins/:pluginId/versions/:version // Delete version (super-admin)

// Plugin Ratings
POST   /api/plugins/:pluginId/ratings           // Create/update rating
GET    /api/plugins/:pluginId/ratings           // Get all ratings
GET    /api/plugins/:pluginId/ratings/me        // Get current user's rating
DELETE /api/plugins/:pluginId/ratings/:id       // Delete rating

// Plugin Publishing
POST   /api/plugins/:pluginId/submit            // Submit for review
POST   /api/plugins/:pluginId/approve           // Approve (super-admin)
POST   /api/plugins/:pluginId/reject            // Reject (super-admin)
POST   /api/plugins/:pluginId/deprecate         // Deprecate (super-admin)

// Plugin Search
GET    /api/plugins/search                      // Advanced search
GET    /api/plugins/popular                     // Popular plugins
GET    /api/plugins/trending                    // Trending plugins
GET    /api/plugins/recommended                 // Recommended for tenant

// Plugin Installation
POST   /api/tenants/:tenantId/plugins/:pluginId/install  // Install with version
GET    /api/tenants/:tenantId/plugins/:pluginId/updates  // Check for updates
POST   /api/tenants/:tenantId/plugins/:pluginId/update   // Update to new version
```

**Files**:

```
apps/core-api/src/routes/plugin-marketplace.ts (~600 lines)
apps/core-api/src/__tests__/routes/plugin-marketplace.test.ts (~400 lines)
```

---

## ğŸ¨ Frontend Tasks (Week 2-3: 60 hours)

### Task 7: Super-Admin Marketplace Enhancements (16h)

**Components**:

```
apps/super-admin/src/components/marketplace/
â”œâ”€â”€ PublishPluginModal.tsx       (~350 lines) - Multi-step publish wizard
â”œâ”€â”€ PluginVersionManager.tsx     (~250 lines) - Version management UI
â”œâ”€â”€ PluginReviewQueue.tsx        (~300 lines) - Review pending plugins
â”œâ”€â”€ PluginAnalytics.tsx          (~200 lines) - Download/install analytics
â””â”€â”€ RatingModeration.tsx         (~150 lines) - Moderate reviews
```

**Features**:

- ğŸ“¤ **Publish Workflow**: Multi-step modal (upload â†’ validate â†’ configure â†’ publish)
- ğŸ“Š **Analytics Dashboard**: Downloads, installs, ratings per plugin
- âœ… **Review Queue**: Approve/reject pending plugins
- ğŸ·ï¸ **Version Management**: Create, edit, delete versions
- â­ **Rating Moderation**: View and moderate user reviews

### Task 8: Tenant Marketplace UI (20h)

**Pages**:

```
apps/web/src/pages/marketplace/
â”œâ”€â”€ MarketplacePage.tsx          (~500 lines) - Main browse page
â”œâ”€â”€ PluginDetailPage.tsx         (~400 lines) - Plugin detail with install
â””â”€â”€ MyPluginsPage.tsx            (~350 lines) - Installed plugins management

apps/web/src/components/marketplace/
â”œâ”€â”€ PluginCard.tsx               (~200 lines) - Plugin grid card
â”œâ”€â”€ PluginSearchBar.tsx          (~150 lines) - Search with autocomplete
â”œâ”€â”€ PluginFilters.tsx            (~200 lines) - Advanced filters sidebar
â”œâ”€â”€ InstallWizard.tsx            (~350 lines) - Installation wizard
â”œâ”€â”€ PluginRatingWidget.tsx       (~150 lines) - Star rating display/input
â”œâ”€â”€ PluginReviewList.tsx         (~200 lines) - Reviews with pagination
â””â”€â”€ UpdateNotification.tsx       (~100 lines) - Plugin update banner
```

**Features**:

- ğŸ” **Search & Browse**: Real-time search with autocomplete
- ğŸ“¦ **Plugin Cards**: Visual cards with screenshots, rating, category
- ğŸ¯ **Advanced Filters**: Category, rating, price, popularity
- âš™ï¸ **Installation Wizard**: Step-by-step install (configure â†’ confirm â†’ install)
- â­ **Rating & Reviews**: View and write reviews
- ğŸ”” **Update Notifications**: Banner when updates available

### Task 9: Plugin Rating & Review UI (12h)

**Components**:

```typescript
// apps/web/src/components/marketplace/RatingWidget.tsx
interface RatingWidgetProps {
  pluginId: string;
  currentRating?: number;
  onRate: (rating: number, review?: string) => Promise<void>;
  readonly?: boolean;
}

// apps/web/src/components/marketplace/ReviewList.tsx
interface ReviewListProps {
  pluginId: string;
  sortBy?: 'newest' | 'helpful' | 'rating';
  filterRating?: number;
}
```

**Features**:

- â­ Star rating input (interactive)
- ğŸ“ Review text editor (markdown support)
- ğŸ‘ Helpful/not helpful voting
- ğŸ—‚ï¸ Sort and filter reviews
- ğŸ“Š Rating distribution chart

### Task 10: Installation Wizard (12h)

**Flow**:

```
Step 1: Plugin Selection
  â”œâ”€ Plugin info summary
  â”œâ”€ Version selector (latest, specific)
  â””â”€ Prerequisites check

Step 2: Configuration
  â”œâ”€ Required config fields (from manifest)
  â”œâ”€ Optional config fields
  â””â”€ Validation

Step 3: Review & Confirm
  â”œâ”€ Config summary
  â”œâ”€ Permissions required
  â””â”€ Pricing (if applicable)

Step 4: Installation
  â”œâ”€ Progress indicator
  â”œâ”€ Real-time status updates
  â””â”€ Success/error handling

Step 5: Post-Install
  â”œâ”€ Setup instructions
  â”œâ”€ Quick tour (optional)
  â””â”€ Go to plugin
```

**Component**:

```typescript
// apps/web/src/components/marketplace/InstallWizard.tsx
interface InstallWizardProps {
  plugin: Plugin;
  onComplete: () => void;
  onCancel: () => void;
}

const steps = [
  { id: 'select', title: 'Select Version' },
  { id: 'configure', title: 'Configuration' },
  { id: 'review', title: 'Review' },
  { id: 'install', title: 'Installing...' },
  { id: 'complete', title: 'Complete' },
];
```

---

## ğŸ› ï¸ CLI Enhancement (Week 3: 12 hours)

### Task 11: Enhanced `plexica publish` Command

**Features**:

```bash
# Interactive publish
plexica publish

# Non-interactive (CI/CD)
plexica publish --non-interactive \
  --version 1.2.3 \
  --changelog "Bug fixes and improvements" \
  --api-url https://api.plexica.io \
  --api-key $PLEXICA_API_KEY

# Dry-run mode
plexica publish --dry-run

# Publish specific version
plexica publish --version 1.2.3
```

**Workflow**:

```
1. Validate manifest.json (schema, semver, required fields)
2. Build plugin (frontend + backend)
3. Run tests (optional, with --skip-tests flag)
4. Package assets (create .tar.gz)
5. Upload to CDN (MinIO)
6. Create plugin version via API
7. Submit for review (or publish if auto-approved)
8. Display success message with review status
```

**Implementation**:

```typescript
// packages/cli/src/commands/publish.ts

interface PublishOptions {
  version?: string;
  changelog?: string;
  apiUrl?: string;
  apiKey?: string;
  nonInteractive?: boolean;
  dryRun?: boolean;
  skipTests?: boolean;
}

class PublishCommand {
  async execute(options: PublishOptions): Promise<void> {
    // 1. Validate manifest
    const manifest = await this.validateManifest();

    // 2. Determine version (from args or prompt)
    const version = await this.getVersion(options, manifest);

    // 3. Build plugin
    await this.buildPlugin();

    // 4. Run tests (unless --skip-tests)
    if (!options.skipTests) {
      await this.runTests();
    }

    // 5. Package assets
    const packagePath = await this.packagePlugin(version);

    // 6. Upload to CDN
    const cdnUrl = await this.uploadToCDN(packagePath, options);

    // 7. Create version via API
    const result = await this.createVersion(
      {
        pluginId: manifest.id,
        version,
        changelog: options.changelog || (await this.getChangelog()),
        assetUrl: cdnUrl,
      },
      options
    );

    // 8. Display result
    this.displayResult(result);
  }

  private async validateManifest(): Promise<PluginManifest> {}
  private async getVersion(options: PublishOptions, manifest: PluginManifest): Promise<string> {}
  private async buildPlugin(): Promise<void> {}
  private async runTests(): Promise<void> {}
  private async packagePlugin(version: string): Promise<string> {}
  private async uploadToCDN(path: string, options: PublishOptions): Promise<string> {}
  private async createVersion(data: any, options: PublishOptions): Promise<any> {}
  private displayResult(result: any): void {}
}
```

**Files**:

```
packages/cli/src/commands/publish.ts (~500 lines)
packages/cli/src/lib/plugin-packager.ts (~200 lines)
packages/cli/src/lib/plugin-validator.ts (~150 lines)
packages/cli/src/__tests__/commands/publish.test.ts (~300 lines)
```

---

## ğŸ§ª Testing (Week 3: 16 hours)

### Unit Tests

- âœ… PluginVersionService (15 tests)
- âœ… PluginRatingService (12 tests)
- âœ… PluginPublishingService (18 tests)
- âœ… PluginSearchService (20 tests)

### Integration Tests

- âœ… API endpoints (25 tests)
- âœ… Search functionality (10 tests)
- âœ… Publishing workflow (8 tests)

### E2E Tests (Playwright)

- âœ… Browse marketplace
- âœ… Install plugin via wizard
- âœ… Rate and review plugin
- âœ… Publish new plugin version (super-admin)

**Target**: > 80% coverage

---

## ğŸ“š Documentation (Week 3: 8 hours)

### Developer Guides

- âœ… `docs/guides/PLUGIN_PUBLISHING.md` - How to publish plugins
- âœ… `docs/guides/MARKETPLACE_USAGE.md` - Using the marketplace
- âœ… `docs/api/MARKETPLACE_API.md` - API reference

### User Guides

- âœ… `docs/user/INSTALL_PLUGINS.md` - Installing plugins
- âœ… `docs/user/RATE_PLUGINS.md` - Rating and reviewing plugins

---

## ğŸ“Š Deliverables Summary

### Backend

- âœ… 3 new services (Version, Rating, Publishing)
- âœ… Enhanced search service
- âœ… 20+ new API endpoints
- âœ… Database migration with 3 new tables

### Frontend

- âœ… Super-Admin: 5 new components
- âœ… Tenant App: 10 new components, 3 new pages
- âœ… Installation wizard
- âœ… Rating & review system

### CLI

- âœ… Enhanced `publish` command
- âœ… Validation & packaging utilities

### Testing

- âœ… 88+ new tests
- âœ… > 80% coverage

### Documentation

- âœ… 5 comprehensive guides

---

## ğŸ¯ Estimated Effort

| Category      | Hours    | % of Total   |
| ------------- | -------- | ------------ |
| Backend       | 80h      | 67%          |
| Frontend      | 60h      | 50%          |
| CLI           | 12h      | 10%          |
| Testing       | 16h      | 13%          |
| Documentation | 8h       | 7%           |
| **Total**     | **120h** | **~3 weeks** |

---

## ğŸš€ Next Steps

**Ready to start?** Let's begin with:

1. âœ… Database migration (PluginVersion, PluginRating, PluginInstallation)
2. âœ… PluginVersionService implementation
3. âœ… REST API endpoints for versioning

**Shall we proceed with Task 1: Database Migration?**
