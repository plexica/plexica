# User Journeys: Authorization System (RBAC + ABAC)

> **Spec reference**: `.forge/specs/003-authorization/spec.md`
> **Design spec**: `.forge/specs/003-authorization/design-spec.md`
> **Generated by**: `/forge-ux`
> **Date**: 2026-02-22

---

## 1. Personas

### Persona 1: Dana

| Field               | Detail                                                                                                                                                                                                                                |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Name                | Dana                                                                                                                                                                                                                                  |
| Role                | Tenant Administrator                                                                                                                                                                                                                  |
| Age range           | 32-50                                                                                                                                                                                                                                 |
| Goal                | Configure access control for her 40-person team so the right people have the right permissions without constant requests                                                                                                              |
| Pain points         | 1. Permission changes feel risky â€” hard to understand who is affected. 2. Existing tools show flat lists of permissions with no grouping â€” overwhelming with plugins. 3. No way to preview the effect of a role change before saving. |
| Tech literacy       | High                                                                                                                                                                                                                                  |
| Device preference   | Desktop                                                                                                                                                                                                                               |
| Accessibility needs | None                                                                                                                                                                                                                                  |
| Quote               | _"I need to be confident that when I change a permission, I know exactly who gains or loses access."_                                                                                                                                 |

---

### Persona 2: Marco

| Field               | Detail                                                                                                                                                                                                                 |
| ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Name                | Marco                                                                                                                                                                                                                  |
| Role                | Team Lead / End User                                                                                                                                                                                                   |
| Age range           | 25-40                                                                                                                                                                                                                  |
| Goal                | Understand why he can or cannot access a feature, and request the right role from his admin                                                                                                                            |
| Pain points         | 1. Gets generic "Access denied" errors with no explanation of what permission is needed. 2. Doesn't know which role to ask for when locked out of a feature. 3. No self-service to view his own roles and permissions. |
| Tech literacy       | Medium                                                                                                                                                                                                                 |
| Device preference   | Desktop                                                                                                                                                                                                                |
| Accessibility needs | None                                                                                                                                                                                                                   |
| Quote               | _"When I can't access something, I want to know what I'm missing â€” not just 'you can't do this'."_                                                                                                                     |

---

### Persona 3: Sofia

| Field               | Detail                                                                                                                                                                                                                                                     |
| ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Name                | Sofia                                                                                                                                                                                                                                                      |
| Role                | Security / Compliance Officer                                                                                                                                                                                                                              |
| Age range           | 35-55                                                                                                                                                                                                                                                      |
| Goal                | Define attribute-based policies that restrict data access by team, department, or time so the tenant meets compliance requirements                                                                                                                         |
| Pain points         | 1. Policies need complex conditions (team + time + resource state) but most tools only offer simple rules. 2. Hard to audit which policies are currently active and what they restrict. 3. Worries about policy conflicts creating unexpected access gaps. |
| Tech literacy       | High                                                                                                                                                                                                                                                       |
| Device preference   | Desktop                                                                                                                                                                                                                                                    |
| Accessibility needs | Low vision (uses 150% browser zoom)                                                                                                                                                                                                                        |
| Quote               | _"I need to build policies with multiple conditions and be certain they won't accidentally lock everyone out."_                                                                                                                                            |

---

## 2. User Journeys

---

### Journey 1: Dana â€” Creating a Custom Role for Sales Team

**Trigger**: The CRM plugin has been installed and Dana needs to create a "Sales Manager" role that grants CRM permissions plus basic workspace access.

**Preconditions**:

- Dana is logged in as `tenant_admin`
- CRM plugin is installed and has registered its permissions (`crm:contacts:read`, `crm:contacts:write`, `crm:deals:*`)
- Fewer than 50 custom roles exist in the tenant

#### Happy Path

| Step | User Action                                                      | System Response                                                                                                                                            | Emotional State                                                  |
| ---- | ---------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- |
| 1    | Navigates to Access Control > Roles in tenant admin sidebar      | Role List screen loads. Shows system roles (with lock badges) at top, then custom roles sorted alphabetically.                                             | ğŸ˜ Neutral â€” familiar navigation                                 |
| 2    | Clicks "Create Role" button                                      | Role Editor screen opens as a new page. Name and description fields are empty. Permission groups are collapsed.                                            | ğŸ˜ Neutral â€” clear entry point                                   |
| 3    | Types "Sales Manager" as role name, adds description             | Name field validates uniqueness in real-time. Green checkmark appears next to name.                                                                        | ğŸ˜Š Reassured â€” immediate feedback                                |
| 4    | Expands "Core" permission group                                  | Core permissions appear as checkboxes: `workspaces:read`, `workspaces:write`, `users:read`, etc.                                                           | ğŸ˜ Neutral â€” organized layout                                    |
| 5    | Checks `workspaces:read` and `users:read`                        | Checkboxes are selected. Permission count badge updates: "2 selected".                                                                                     | ğŸ˜ Neutral                                                       |
| 6    | Expands "CRM" plugin permission group                            | CRM permissions appear: `crm:contacts:read`, `crm:contacts:write`, `crm:deals:*` (wildcard), plus `crm:deals:read`, `crm:deals:write`, `crm:deals:delete`. | ğŸ˜Š Relieved â€” permissions are grouped by plugin, not a flat list |
| 7    | Checks `crm:deals:*` wildcard checkbox                           | All sub-permissions under `crm:deals:` are automatically selected (read, write, delete). Wildcard checkbox shows as checked. Per FR-021.                   | ğŸ‰ Delighted â€” smart auto-selection saves time                   |
| 8    | Checks `crm:contacts:read` and `crm:contacts:write` individually | Two checkboxes selected.                                                                                                                                   | ğŸ˜ Neutral                                                       |
| 9    | Reviews the permission summary at bottom of page                 | Summary panel shows: "5 permissions selected across 2 groups (Core, CRM)". Lists all selected permissions.                                                 | ğŸ˜Š Confident â€” can verify before saving                          |
| 10   | Clicks "Save Role"                                               | Loading spinner on button. Success toast: "Role 'Sales Manager' created successfully." Redirects to Role Detail view.                                      | ğŸ‰ Satisfied â€” task complete                                     |

**Outcome**: "Sales Manager" role is created with 5 permissions. It appears in the Role List and is ready to be assigned to users.

**Delight opportunities**:

- Step 3: Auto-suggest role names based on installed plugins (e.g., "CRM Manager", "CRM Viewer").
- Step 7: Show a tooltip on the wildcard checkbox explaining "Grants all current and future actions on this resource."
- Step 9: Permission summary could show an estimated user count ("0 users currently have this role").

---

#### Edge Case A: Duplicate Role Name

**Trigger**: Dana types a role name that already exists.

| Step | User Action                       | System Response                                                                                                             | Emotional State                             |
| ---- | --------------------------------- | --------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------- |
| 1-2  | Same as happy path                | â€”                                                                                                                           | ğŸ˜ Neutral                                  |
| 3    | Types "User" (a system role name) | Inline error below name field: "A role named 'User' already exists. Choose a different name." Save button remains disabled. | ğŸ˜• Mildly frustrated â€” but instant feedback |
| 4    | Changes name to "Sales User"      | Error clears. Green checkmark appears. Save button enables.                                                                 | ğŸ˜Š Relieved â€” easy recovery                 |

**Recovery path**: Inline validation prevents submission. User changes the name.
**Feedback**: Red text below input: "A role named '{name}' already exists. Choose a different name."

---

#### Edge Case B: Custom Role Limit Reached (50 roles)

**Trigger**: Tenant already has 50 custom roles. Dana tries to create a 51st.

| Step | User Action                               | System Response                                                                                                                                                                | Emotional State              |
| ---- | ----------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------- |
| 1    | Navigates to Role List                    | Role List shows a warning banner: "You've reached the maximum of 50 custom roles. Delete an existing role to create a new one." "Create Role" button is disabled with tooltip. | ğŸ˜¤ Frustrated â€” but informed |
| 2    | Hovers over disabled "Create Role" button | Tooltip: "Custom role limit reached (50/50). Delete an unused role to create a new one."                                                                                       | ğŸ˜ Informed â€” clear action   |

**Recovery path**: User deletes an unused custom role, then returns to create a new one.
**Feedback**: Warning banner at top of Role List. Disabled button with tooltip.

---

#### Edge Case C: Permission Denied (non-admin tries to access Roles)

**Trigger**: Marco (role: `user`) navigates directly to `/admin/access-control/roles`.

| Step | User Action                                    | System Response                                                                                                                                                                        | Emotional State       |
| ---- | ---------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- |
| 1    | Types URL directly or follows a stale bookmark | Redirect to a 403 page: "You don't have permission to manage roles." Body: "Managing roles requires the `roles:read` permission. Contact your tenant administrator to request access." | ğŸ˜• Confused initially |
| 2    | Reads message                                  | Understands the required permission and who to contact.                                                                                                                                | ğŸ˜ Informed           |

**Message**: "You don't have permission to manage roles. This page requires the `roles:read` permission. Contact your tenant administrator to request access."

---

### Journey 2: Dana â€” Assigning a Role to a User

**Trigger**: A new team member (Alex) has joined and needs the "Sales Manager" role.

**Preconditions**:

- Dana is logged in as `tenant_admin`
- Alex's user account exists in the tenant
- "Sales Manager" custom role exists

#### Happy Path

| Step | User Action                                                         | System Response                                                                                                                                                                                 | Emotional State                                    |
| ---- | ------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------- |
| 1    | Navigates to Access Control > Users (or clicks user from team list) | User list loads with search/filter. Shows each user's name, email, and current roles as badges.                                                                                                 | ğŸ˜ Neutral                                         |
| 2    | Searches for "Alex" in search input                                 | Table filters in real-time. Alex's row appears. Shows current role badges: "User" (system).                                                                                                     | ğŸ˜Š Quick â€” fast search                             |
| 3    | Clicks "Manage Roles" button on Alex's row                          | Role assignment dialog opens. Left side: available roles (checkboxes). Right side: currently assigned roles. "User" (system) is checked and shown with lock icon (cannot unassign system role). | ğŸ˜ Neutral â€” clear layout                          |
| 4    | Checks "Sales Manager" checkbox                                     | "Sales Manager" moves to assigned column. Permission count updates: "+5 permissions from Sales Manager."                                                                                        | ğŸ˜Š Confident â€” can see the impact                  |
| 5    | Clicks "Save"                                                       | Loading state. Success toast: "Roles updated for Alex. Changes take effect immediately." Dialog closes. User row updates to show "User, Sales Manager" badges.                                  | ğŸ‰ Satisfied â€” immediate feedback and confirmation |

**Outcome**: Alex now has both the "User" system role and the "Sales Manager" custom role. Per FR-019, the permission cache is flushed immediately.

**Delight opportunities**:

- Step 4: Show a diff of permissions gained/lost: "+crm:contacts:read, +crm:contacts:write, +crm:deals:\*".
- Step 5: Toast could include "Alex will have access to CRM Contacts and Deals on their next page load."

---

#### Edge Case A: Role Removal Confirmation

**Trigger**: Dana removes a role from a user who relies on it.

| Step | User Action                                                                            | System Response                                                                                                                                                          | Emotional State                    |
| ---- | -------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------- |
| 1-3  | Same as happy path, opens role assignment dialog for existing user with multiple roles | â€”                                                                                                                                                                        | ğŸ˜ Neutral                         |
| 4    | Unchecks "Sales Manager"                                                               | Warning callout appears below: "Removing 'Sales Manager' will revoke 5 permissions: crm:contacts:read, crm:contacts:write, crm:deals:\*. This takes effect immediately." | ğŸ¤” Thoughtful â€” considering impact |
| 5    | Clicks "Save"                                                                          | Confirmation dialog: "Remove 'Sales Manager' from Alex? They will lose access to CRM Contacts and Deals immediately." [Cancel] [Remove Role] (destructive button).       | ğŸ˜ Deliberate                      |
| 6    | Clicks "Remove Role"                                                                   | Success toast: "Sales Manager removed from Alex." Cache flushed.                                                                                                         | ğŸ˜Š Confident â€” informed decision   |

**Recovery path**: If removed in error, Dana can re-assign the role immediately.
**Feedback**: Confirmation dialog with destructive-styled button. Toast on success.

---

#### Edge Case B: Empty State â€” No Users

**Trigger**: New tenant with no users except the admin.

| Step | User Action                         | System Response                                                                                                                                                                                     | Emotional State             |
| ---- | ----------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------- |
| 1    | Navigates to Access Control > Users | Empty state: Illustration of people with a plus icon. Heading: "No team members yet." Body: "Invite users to your tenant to start assigning roles." CTA: "Invite Users" (links to user management). | ğŸ˜ Neutral â€” guided         |
| 2    | Clicks "Invite Users"               | Navigates to user invitation flow.                                                                                                                                                                  | ğŸ˜Š Guided â€” clear next step |

**Empty state copy**:

- Heading: "No team members yet"
- Body: "Invite users to your tenant to start assigning roles."
- CTA label: "Invite Users"

---

### Journey 3: Sofia â€” Creating an ABAC Policy for Data Restriction

**Trigger**: Sofia needs to create a policy that restricts Sales team members to only see their own deals (result-set filtering).

**Preconditions**:

- Sofia is logged in as `tenant_admin` with `policies:write` permission
- CRM plugin is installed
- ABAC feature is enabled (post Phase 3 rollout via feature flag)

#### Happy Path

| Step | User Action                                                                                          | System Response                                                                                                                                    | Emotional State                                  |
| ---- | ---------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------ |
| 1    | Navigates to Access Control > Policies                                                               | Policy List loads. Shows existing policies in a table: name, resource, effect (DENY/FILTER badge), source, status.                                 | ğŸ˜ Neutral                                       |
| 2    | Clicks "Create Policy"                                                                               | Policy Editor screen opens. Name, resource, effect, and condition builder are empty.                                                               | ğŸ˜ Neutral â€” blank slate                         |
| 3    | Types policy name: "Sales team: own deals only"                                                      | Name field accepts input.                                                                                                                          | ğŸ˜ Neutral                                       |
| 4    | Selects resource pattern: types `crm:deals:*` (with autocomplete suggestions from installed plugins) | Autocomplete dropdown shows matching resource patterns from registered permissions. Selects `crm:deals:*`.                                         | ğŸ˜Š Helpful â€” no need to memorize permission keys |
| 5    | Selects effect: "FILTER" (from radio buttons: DENY / FILTER)                                         | FILTER selected. Hint text appears: "FILTER policies inject row-level constraints. Users still access the endpoint but see only matching results." | ğŸ¤” Learning â€” understands the difference         |
| 6    | Clicks "Add Condition" in the condition builder                                                      | A condition row appears with three dropdowns: [Attribute â–¼] [Operator â–¼] [Value field].                                                            | ğŸ˜ Neutral                                       |
| 7    | Selects attribute: `user.teamId`, operator: `equals`, value: `resource.teamId`                       | Condition row is complete. The tree visualizes as a single leaf node.                                                                              | ğŸ˜Š Confident â€” straightforward condition         |
| 8    | Clicks "Add Group (AND)" to add a second condition                                                   | An AND group wraps the existing condition. A new empty condition row appears inside the AND group. Indentation shows nesting visually.             | ğŸ˜Š Powerful â€” can build complex logic            |
| 9    | In the new row, selects: `resource.status`, `notEquals`, `archived`                                  | Second condition complete. Tree shows: ALL(user.teamId equals resource.teamId, resource.status notEquals archived).                                | ğŸ˜Š Clear â€” visual tree matches intent            |
| 10   | Reviews the condition summary                                                                        | Plain-English summary: "Show results where the user's team matches the deal's team AND the deal is not archived."                                  | ğŸ‰ Delighted â€” human-readable summary            |
| 11   | Clicks "Save Policy"                                                                                 | Loading state. Success toast: "Policy 'Sales team: own deals only' created. It will apply to all future requests."                                 | ğŸ‰ Satisfied â€” complex task completed            |

**Outcome**: The FILTER policy is saved. When Sales team users request `crm:deals:*`, the authorization engine injects `WHERE teamId = <user.teamId> AND status != 'archived'` as query constraints.

**Delight opportunities**:

- Step 4: Autocomplete resource patterns from registered permissions.
- Step 10: Plain-English condition summary generated from the condition tree.
- Step 11: Link to "Test this policy" (dry-run against a user/resource pair) â€” future feature.

---

#### Edge Case A: Invalid Condition Configuration

**Trigger**: Sofia selects an operator that doesn't match the attribute type.

| Step | User Action                                                           | System Response                                                                                                                                                                                | Emotional State           |
| ---- | --------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------- |
| 1-6  | Same as happy path                                                    | â€”                                                                                                                                                                                              | ğŸ˜ Neutral                |
| 7    | Selects attribute: `user.teamId`, operator: `greaterThan`, value: `5` | Inline warning: "The 'greaterThan' operator is typically used with numeric attributes. 'user.teamId' is a string identifier. Did you mean 'equals'?" Save is not blocked (warning, not error). | ğŸ¤” Uncertain â€” but guided |
| 8    | Changes operator to `equals`                                          | Warning clears.                                                                                                                                                                                | ğŸ˜Š Relieved               |

**Recovery path**: Warning is advisory. Save is allowed to support advanced use cases.
**Feedback**: Orange warning icon + text below the condition row.

---

#### Edge Case B: Empty Policy List

**Trigger**: No ABAC policies exist in the tenant (first-time setup or ABAC just enabled).

| Step | User Action                            | System Response                                                                                                                                                                                                                                                                                                                   | Emotional State             |
| ---- | -------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------- |
| 1    | Navigates to Access Control > Policies | Empty state: Illustration of a shield with a filter icon. Heading: "No access policies yet." Body: "Access policies let you restrict data access based on user attributes, resource properties, and environment conditions. RBAC roles handle basic access â€” policies add fine-grained control." CTA: "Create Your First Policy". | ğŸ˜ Neutral â€” well-explained |
| 2    | Clicks CTA                             | Policy Editor opens.                                                                                                                                                                                                                                                                                                              | ğŸ˜Š Guided                   |

**Empty state copy**:

- Heading: "No access policies yet"
- Body: "Access policies let you restrict data access based on user attributes, resource properties, and environment conditions. RBAC roles handle basic access â€” policies add fine-grained control."
- CTA label: "Create Your First Policy"

---

## 3. Journey Flow Diagram

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    Tenant Admin Sidebar  â”‚
                              â”‚   Access Control Section â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚      â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â†“                            â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Role List    â”‚           â”‚  Policy List   â”‚
                  â”‚  (FR-003/023) â”‚           â”‚  (FR-009/017)  â”‚
                  â””â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”˜           â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                      â”‚   â”‚   â”‚                 â”‚      â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚      â”‚
           â†“              â†“            â†“        â†“      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Role Detailâ”‚ â”‚ Role Editorâ”‚ â”‚ User    â”‚ â”‚ Policy     â”‚
    â”‚ (view)     â”‚ â”‚ (create/   â”‚ â”‚ Role    â”‚ â”‚ Editor     â”‚
    â”‚            â”‚ â”‚  edit)     â”‚ â”‚ Assign  â”‚ â”‚ (FR-022)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ (FR-020/  â”‚ â”‚ (FR-006)â”‚ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚  FR-021)  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚
                   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚            â”‚
                         â”‚            â”‚            â”‚
                         â†“            â†“            â†“
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚         Success / Error          â”‚
                   â”‚  Toast notification + cache flush â”‚
                   â”‚  (FR-019)                        â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Cross-References

| Artifact      | Path                                            |
| ------------- | ----------------------------------------------- |
| Feature spec  | `.forge/specs/003-authorization/spec.md`        |
| Design spec   | `.forge/specs/003-authorization/design-spec.md` |
| Constitution  | `.forge/constitution.md`                        |
| Design system | `.forge/ux/design-system.md`                    |
